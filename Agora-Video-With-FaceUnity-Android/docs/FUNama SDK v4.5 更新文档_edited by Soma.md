# FUNama SDK v4.5 更新文档

本次更新主要包含以下改动：
- 新增“美颜滤镜”类目
- 新增“精准美肤”功能
- 优化美颜中美白、红润两个功能的效果
- 新增“严格跟踪”接口，在跟踪算法不确定时停止跟踪
- 修复表情优化功能中一个会导致崩溃的bug
- 修复iOS平台上骨骼动画支持问题
- 修复v4.1.6之后版本FUEditor里骨骼动画支持问题
- 轻微优化了avatar的绘制效率

## 美颜滤镜

美颜滤镜功能是以美颜为目的的滤镜，可以针对人脸起到综合美白红润的效果。第一批美颜滤镜共有5款，分别是 自然、淡雅、粉嫩、清新、红润。

```C
//自然，淡雅，粉嫩，清新，红润
"nature", "danya", "fennen", "qingxin", "hongrun"
```

该功能使用时和原美颜中的滤镜功能完全一致，在加载美颜道具```face_beautification.bundle```后，通过设定该道具的参数```filter_name```进行指定，参考代码如下：

```C
//  iOS
[FURenderer itemSetParam:items[1] withName:@"filter_name" value:@"qingxin"];
```

此外，新版本美颜道具新增了一个参数```filter_level```来控制滤镜的强度。该参数的取值范围为[0.0, 1.0]，0为无效果，1.0为默认效果。本地客户端需要针对每个滤镜记录用户选择的filter_level，当切换滤镜时，设置该参数。

## 精准美肤

美颜的磨皮功能中新增了精准美肤功能，可以使磨皮的模糊效果只对皮肤有效，对于非皮肤区域降低磨皮效果，减少图像涂抹感，使图像更加自然。

启用该功能需要设定美颜道具的参数 ```skin_detect```，设置为1为启用该功能，设置为0为关闭该功能。默认情况下该功能不开启。

另一个参数```nonskin_blur_scale```可以控制非皮肤区域的磨皮程度，参数范围为[0.0, 1.0]，0.0表示无磨皮效果，1.0表示和皮肤磨皮效果相同，该参数的默认值为0.45。该参数起效需要先开启```skin_detect```参数。


## 改进美白、红润

这个版本优化了美白和红润功能，使效果更加真实，不过曝过红。

建议新版本中的肤色调整以美颜滤镜功能为主，美白、红润作为进一步的效果微调，可实现最为理想的美颜效果。

美白和红润功能的使用和之前版本相同，在加载美颜道具```face_beautification.bundle```后，通过设定该道具的参数```color_level```（美白）和```red_level```（红润）进行指定。两个参数的通常取值范围为[0.0, 1.0]，特殊需求下可以设置超过1.0的值。默认```color_level```为0.2，默认```red_level```为0.5。

## 严格跟踪

该功能是指在图像信息不全（面部遮挡、面部部分移出图像等）的情况下，为避免得到异常的结果，降低算法对错误的容忍程度，将直接提示人脸识别失败。

该功能开启后，具体会产生以下两点变化：
- 在人脸landmark的中心点移出屏幕时，直接返回失败
- 算法对错误的容忍阈值降为之前的二分之一，更容易导致识别失败

通过接口```fuSetStrictTracking(int i)```控制该功能，参数传0为禁用该功能，非0为启用该功能，默认情况下该功能关闭。


